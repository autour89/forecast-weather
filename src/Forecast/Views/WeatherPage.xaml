<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Forecast.Core.ViewModels"
             x:Class="Forecast.Views.WeatherPage"
             x:DataType="viewmodels:WeatherViewModel"
             Title="Weather Forecast"
             BackgroundColor="{StaticResource PageBackgroundBrush}">

    <RefreshView IsRefreshing="{Binding IsRefreshing}"
                 Command="{Binding RefreshCommand}">
        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="20">

                <Label Text="Weather App" 
                       Style="{StaticResource Headline}"
                       Margin="0,0,0,10"/>

                <Border StrokeThickness="1" 
                        Stroke="{StaticResource BorderBrush}"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="{StaticResource CardBackgroundBrush}"
                        Padding="12">
                    <Grid ColumnDefinitions="*,Auto,Auto" 
                          ColumnSpacing="8">
                        <Entry Grid.Column="0"
                               Placeholder="Enter city name"
                               Text="{Binding SearchCity, Mode=TwoWay}"
                               ReturnCommand="{Binding SearchCommand}"
                               VerticalOptions="Center"/>
                        
                        <Button Grid.Column="1"
                                Text="Search" 
                                Command="{Binding SearchCommand}"
                                IsEnabled="{Binding SearchCommand.IsExecuting, Converter={StaticResource InvertedBoolConverter}}"/>
                        
                        <Button Grid.Column="2"
                                Text="ðŸ“ Here" 
                                Command="{Binding CurrentLocationCommand}"
                                IsEnabled="{Binding CurrentLocationCommand.IsExecuting, Converter={StaticResource InvertedBoolConverter}}"/>
                    </Grid>
                </Border>

                <ActivityIndicator IsRunning="{Binding SearchCommand.IsExecuting}" 
                                   IsVisible="{Binding SearchCommand.IsExecuting}"
                                   HorizontalOptions="Center"
                                   Margin="0,10"/>

                <Border IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotEmptyConverter}}"
                        StrokeThickness="1"
                        Stroke="Red"
                        StrokeShape="RoundRectangle 8"
                        BackgroundColor="#20FF0000"
                        Padding="12">
                    <Label Text="{Binding ErrorMessage}" 
                           TextColor="Red"
                           HorizontalTextAlignment="Center"/>
                </Border>

                <Border IsVisible="{Binding HasWeatherData}"
                        StrokeThickness="1"
                        Stroke="{StaticResource BorderBrush}"
                        StrokeShape="RoundRectangle 16"
                        BackgroundColor="{StaticResource CardBackgroundBrush}"
                        Padding="20">
                    <Grid ColumnDefinitions="Auto,*" 
                          ColumnSpacing="16">
                        <Image Grid.Column="0"
                               Source="{Binding Data.IconUrl}" 
                               WidthRequest="100" 
                               HeightRequest="100" 
                               Aspect="AspectFit"
                               VerticalOptions="Center"/>
                        
                        <VerticalStackLayout Grid.Column="1" 
                                           Spacing="4"
                                           VerticalOptions="Center">
                            <Label Text="{Binding Data.CityName}" 
                                   FontSize="24" 
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimaryBrush}"/>
                            
                            <Label Text="{Binding Data.TemperatureDisplay}" 
                                   FontSize="48" 
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource Primary}"/>
                            
                            <Label Text="{Binding Data.FeelsLikeDisplay}" 
                                   FontSize="16"
                                   TextColor="{StaticResource TextSecondaryBrush}"/>
                            
                            <Label Text="{Binding Data.Description}" 
                                   FontSize="16"
                                   TextColor="{StaticResource TextSecondaryBrush}"
                                   TextTransform="Uppercase"/>
                        </VerticalStackLayout>
                    </Grid>
                </Border>

                <Border IsVisible="{Binding HasWeatherData}"
                        StrokeThickness="1"
                        Stroke="{StaticResource BorderBrush}"
                        StrokeShape="RoundRectangle 16"
                        BackgroundColor="{StaticResource CardBackgroundBrush}"
                        Padding="20">
                    <Grid RowDefinitions="Auto,Auto,Auto" 
                          ColumnDefinitions="*,*"
                          RowSpacing="12"
                          ColumnSpacing="16">
                        
                        <VerticalStackLayout Grid.Row="0" Grid.Column="0">
                            <Label Text="ðŸ’§ Humidity" 
                                   FontSize="14"
                                   TextColor="{StaticResource TextSecondaryBrush}"/>
                            <Label Text="{Binding Data.Humidity, StringFormat='{0}%'}" 
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimaryBrush}"/>
                        </VerticalStackLayout>

                        <!-- Wind Speed -->
                        <VerticalStackLayout Grid.Row="0" Grid.Column="1">
                            <Label Text="ðŸ’¨ Wind Speed" 
                                   FontSize="14"
                                   TextColor="{StaticResource TextSecondaryBrush}"/>
                            <Label Text="{Binding Data.WindSpeed, StringFormat='{0:F1} m/s'}" 
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimaryBrush}"/>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Row="1" Grid.Column="0">
                            <Label Text="ðŸŒ¡ï¸ Pressure" 
                                   FontSize="14"
                                   TextColor="{StaticResource TextSecondaryBrush}"/>
                            <Label Text="{Binding Data.Pressure, StringFormat='{0} hPa'}" 
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimaryBrush}"/>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Row="1" Grid.Column="1">
                            <Label Text="ðŸŒ Country" 
                                   FontSize="14"
                                   TextColor="{StaticResource TextSecondaryBrush}"/>
                            <Label Text="{Binding Data.Country}" 
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimaryBrush}"/>
                        </VerticalStackLayout>
                    </Grid>
                </Border>

                <Border StrokeThickness="1"
                        Stroke="{StaticResource BorderBrush}"
                        StrokeShape="RoundRectangle 16"
                        BackgroundColor="{StaticResource CardBackgroundBrush}"
                        Padding="20">
                    <VerticalStackLayout Spacing="16">
                        <Label Text="Settings" 
                               FontSize="20" 
                               FontAttributes="Bold"
                               TextColor="{StaticResource TextPrimaryBrush}"/>
                        
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Grid.Column="0"
                                   Text="ðŸŒ™ Dark Theme" 
                                   VerticalOptions="Center"
                                   FontSize="16"
                                   TextColor="{StaticResource TextPrimaryBrush}"/>
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding IsDarkTheme, Mode=TwoWay}" 
                                    HorizontalOptions="End"/>
                        </Grid>
                        
                        <Grid ColumnDefinitions="*,Auto"
                              IsVisible="{Binding HasWeatherData}">
                            <Label Grid.Column="0"
                                   Text="ðŸŒ¡ï¸ Use Celsius" 
                                   VerticalOptions="Center"
                                   FontSize="16"
                                   TextColor="{StaticResource TextPrimaryBrush}"/>
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding Data.UseCelsius, Mode=TwoWay}" 
                                    HorizontalOptions="End"/>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>

</ContentPage>